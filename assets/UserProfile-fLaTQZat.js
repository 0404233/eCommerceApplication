import{x as de,j as e,r as n,u as ce,y as ue,C as fe,s as z}from"./index-O_ssjqPW.js";import{B as J,T as he,a as Z}from"./Tabs-k-s_TOVv.js";import{A as K}from"./Alert-Cyvx1tja.js";import{B as _}from"./Button-nU_ZkUbr.js";import{T as h,F as Q,I as V,S as X,M as S}from"./TextField-De70h6T9.js";import"./utils-Dy26T70t.js";import"./Modal-BdCn2tFC.js";import"./Grow-DC2azDrx.js";const ee=de(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),me="_loader_1tekx_1",pe="_section_1tekx_35",ge="_billing_1tekx_63",xe="_shipping_1tekx_71",i={loader:me,"profile-container":"_profile-container_1tekx_17","user-profile__tabs":"_user-profile__tabs_1tekx_27",section:pe,"address-card":"_address-card_1tekx_49",billing:ge,shipping:xe,"edit-field":"_edit-field_1tekx_81"};function Ce(m,p){const c=new Map,{email:A,firstName:w,lastName:O,dateOfBirth:M}=m;if((!A||!/\S+@\S+\.\S+/.test(A))&&c.set("email","Please enter a valid email address."),(!w||!/^[a-zA-Z]+$/.test(w))&&c.set("firstName","First name must contain only letters."),(!O||!/^[a-zA-Z]+$/.test(O))&&c.set("lastName","Last name must contain only letters."),!M)c.set("dateOfBirth","Please enter a valid birthday.");else{const o=new Date,u=new Date(M),P=o.getFullYear()-u.getFullYear();(P<13||P===13&&o.getMonth()<u.getMonth()||P===13&&o.getMonth()===u.getMonth()&&o.getDate()<u.getDate())&&c.set("dateOfBirth","You must be at least 13 years old.")}return p.forEach((o,u)=>{(!o.streetName||o.streetName.trim().length===0)&&c.set(`address[${u}].streetName`,"Street must not be empty."),(!o.city||!/^[a-zA-Z]+$/.test(o.city))&&c.set(`address[${u}].city`,"City must contain only letters."),(!o.postalCode||!/^\d{6}$|^[A-Za-z]\d[A-Za-z] \d[A-Za-z]\d$/.test(o.postalCode))&&c.set(`address[${u}].postalCode`,"Postal code must match the country format."),(!o.country||o.country.trim()==="")&&c.set(`address[${u}].country`,"Please provide a country.")}),c}const ye=m=>{const p=new Map;return m.streetName.length===0&&p.set("streetName","Street must contain at least one character."),(!/^[a-zA-Z]+$/.test(m.city)||m.city.length===0)&&p.set("city","City must have at least one letter, no digits or symbols."),/^\d{6}$|^[A-Za-z]\d[A-Za-z] \d[A-Za-z]\d$/.test(m.postalCode)||p.set("postalCode","Postal code must match the country format."),m.country||p.set("country","Country is required"),p};function Me(){const[m,p]=n.useState(""),[c,A]=n.useState(""),[w,O]=n.useState(""),[M,o]=n.useState(null),[u,P]=n.useState(0),[a,L]=n.useState(null),[j,T]=n.useState(!1),[f,Y]=n.useState({}),[v,k]=n.useState([]),[g,B]=n.useState({id:"",streetName:"",city:"",postalCode:"",country:""}),[b,R]=n.useState(new Map),[q,te]=n.useState(new Map),[C,U]=n.useState(),[y,W]=n.useState(),[G,I]=n.useState(!1),[N,x]=n.useState(null),H=ce();n.useEffect(()=>{const t=N?setTimeout(()=>x(null),3e3):null;return()=>{t&&clearTimeout(t)}},[N]),n.useEffect(()=>{if(!ue()){H("/login");return}(async()=>{I(!0);try{const s=await z.getCustomerInfo();console.log(s),L(s),Y({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",dateOfBirth:s.dateOfBirth||""}),k(s.addresses.map(r=>({id:r.id,streetName:r.streetName||"",city:r.city||"",postalCode:r.postalCode||"",country:r.country||""}))),U(s.defaultBillingAddressId),W(s.defaultShippingAddressId)}catch{H("/login")}finally{I(!1)}})()},[]);const $=(t,d)=>{Y(s=>({...s,[t]:d}))},D=(t,d,s)=>{const r=[...v];r[t]&&(r[t][d]=s,k(r))},se=t=>{t===C&&U(void 0),t===y&&W(void 0),k(d=>d.filter(s=>s.id!==t))},ae=async()=>{var d,s;if(!a)return;const t=Ce(f,v);if(te(t),!(t.size>0)){if(!C||!y){x({type:"error",text:"Please set default billing and shipping addresses."});return}I(!0),x(null);try{const r=[];f.firstName!==a.firstName&&r.push({action:"setFirstName",firstName:f.firstName}),f.lastName!==a.lastName&&r.push({action:"setLastName",lastName:f.lastName}),f.email!==a.email&&r.push({action:"changeEmail",email:f.email}),f.dateOfBirth!==a.dateOfBirth&&r.push({action:"setDateOfBirth",dateOfBirth:f.dateOfBirth});const le=new Set(a.addresses.map(l=>l.id)),ne=new Set(v.map(l=>l.id));if(a.addresses.forEach(l=>{ne.has(l.id)||r.push({action:"removeAddress",addressId:l.id})}),v.forEach(l=>{if(!le.has(l.id))r.push({action:"addAddress",address:{streetName:l.streetName,city:l.city,postalCode:l.postalCode,country:l.country}});else{const E=a.addresses.find(F=>F.id===l.id);["streetName","city","postalCode","country"].some(F=>(E==null?void 0:E[F])!==l[F])&&r.push({action:"changeAddress",addressId:l.id,address:{...E,streetName:l.streetName,city:l.city,postalCode:l.postalCode,country:l.country}})}}),C!==a.defaultBillingAddressId&&((d=a.billingAddressIds)!=null&&d.includes(C)||r.push({action:"addBillingAddressId",addressId:C}),r.push({action:"setDefaultBillingAddress",addressId:C})),y!==a.defaultShippingAddressId&&((s=a.shippingAddressIds)!=null&&s.includes(y)||(r.push({action:"removeShippingAddressId",addressId:a.defaultShippingAddressId}),r.push({action:"addShippingAddressId",addressId:y})),r.push({action:"setDefaultShippingAddress",addressId:y})),r.length===0){x({type:"success",text:"No changes to save."}),T(!1);return}const oe=await z.updateCustomerProfile(a.version,r);L(oe),x({type:"success",text:"Profile updated successfully"}),T(!1),window.location.reload()}catch{x({type:"error",text:"Failed to update profile"})}finally{I(!1)}}};if(G&&!a)return e.jsx(J,{className:i.loader,children:e.jsx(fe,{})});if(!a)return N?e.jsx(K,{icon:e.jsx(ee,{fontSize:"large"}),severity:N.type,sx:{mb:2},children:N.text}):null;const re={BY:"Belarus",RU:"Russia",US:"USA"},ie=async()=>{if(a){if(c!==w){o("Passwords do not match");return}if(c.length<8){o("Password must be at least 8 characters");return}o(null),I(!0),x(null);try{await z.changeCustomerPassword({id:a.id,version:a.version,currentPassword:m,newPassword:c}),x({type:"success",text:"Password changed successfully"}),p(""),A(""),O("")}catch{x({type:"error",text:"Failed to change password"})}finally{I(!1)}}};return e.jsxs("div",{className:i["profile-container"],children:[e.jsx("h1",{children:"User Profile"}),e.jsxs(he,{className:i["user-profile__tabs"],value:u,onChange:(t,d)=>P(d),sx:{mb:2,"& .MuiTabs-indicator":{backgroundColor:"#737aff"}},textColor:"inherit",children:[e.jsx(Z,{label:"User Info"}),e.jsx(Z,{label:"Addresses"}),e.jsx(Z,{label:"Change Password"})]}),N&&e.jsx(K,{icon:e.jsx(ee,{}),severity:N.type,sx:{mb:2},children:N.text}),e.jsx(_,{variant:"contained",onClick:()=>T(!j),sx:{mb:2,backgroundColor:"#737aff"},children:j?"Cancel":"Edit Profile"}),u===0&&e.jsxs("section",{className:i.section,children:[e.jsx("h2",{children:"Personal Information"}),j?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:`${i["edit-field"]}`,label:"First Name",value:f.firstName||"",onChange:t=>$("firstName",t.target.value),fullWidth:!0,margin:"normal",error:q.has("firstName"),helperText:q.get("firstName")}),e.jsx(h,{className:`${i["edit-field"]}`,label:"Last Name",value:f.lastName||"",onChange:t=>$("lastName",t.target.value),fullWidth:!0,margin:"normal"}),e.jsx(h,{className:`${i["edit-field"]}`,label:"Email",value:f.email||"",onChange:t=>$("email",t.target.value),fullWidth:!0,margin:"normal"}),e.jsx(h,{className:`${i["edit-field"]}`,label:"Date of Birth",type:"date",value:f.dateOfBirth||"",onChange:t=>$("dateOfBirth",t.target.value),fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0}})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"First Name:"})," ",a.firstName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Last Name:"})," ",a.lastName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",a.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date of Birth:"})," ",a.dateOfBirth]})]})]}),u===1&&e.jsxs("section",{className:i.section,children:[e.jsx("h2",{children:"Addresses"}),v.map((t,d)=>e.jsx("div",{className:i["address-card"],children:j?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:`${i["edit-field"]}`,label:"Street",value:t.streetName,onChange:s=>D(d,"streetName",s.target.value),fullWidth:!0,margin:"dense"}),e.jsx(h,{className:`${i["edit-field"]}`,label:"City",value:t.city,onChange:s=>D(d,"city",s.target.value),fullWidth:!0,margin:"dense"}),e.jsx(h,{className:`${i["edit-field"]}`,label:"ZIP",value:t.postalCode,onChange:s=>D(d,"postalCode",s.target.value),fullWidth:!0,margin:"dense"}),e.jsxs(Q,{fullWidth:!0,margin:"dense",children:[e.jsx(V,{id:"country-label",sx:{color:"#737aff"},children:"Country"}),e.jsxs(X,{value:t.country,onChange:s=>D(d,"country",s.target.value),label:"Country",sx:{color:"#fff",".MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},".MuiSvgIcon-root":{color:"#737aff"}},children:[e.jsx(S,{value:"BY",children:"Belarus"}),e.jsx(S,{value:"RU",children:"Russia"}),e.jsx(S,{value:"US",children:"USA"})]})]}),e.jsxs(J,{sx:{display:"flex",gap:2,mt:1},children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"billing",checked:C===t.id,onChange:()=>{U(t.id)}}),"Default Billing"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"shipping",checked:y===t.id,onChange:()=>{W(t.id)}}),"Default Shipping"]})]}),e.jsx(_,{variant:"outlined",color:"error",onClick:()=>se(t.id),sx:{mt:1},children:"Delete Address"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Street:"})," ",t.streetName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"City:"})," ",t.city]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ZIP:"})," ",t.postalCode]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Country:"})," ",re[t.country]||t.country]}),t.id===C&&e.jsx("p",{className:i.billing,children:"✔ Default Billing Address"}),t.id===y&&e.jsx("p",{className:i.shipping,children:"✔ Default Shipping Address"})]})},t.id)),j&&e.jsxs("div",{className:i["address-card"],children:[e.jsx("h3",{children:"Add New Address"}),e.jsx(h,{className:`${i["edit-field"]}`,label:"Street",value:g.streetName,onChange:t=>B({...g,streetName:t.target.value}),fullWidth:!0,margin:"dense",error:b.has("streetName"),helperText:b.get("streetName")}),e.jsx(h,{className:`${i["edit-field"]}`,label:"City",value:g.city,onChange:t=>B({...g,city:t.target.value}),fullWidth:!0,margin:"dense",error:b.has("city"),helperText:b.get("city")}),e.jsx(h,{className:`${i["edit-field"]}`,label:"ZIP",value:g.postalCode,onChange:t=>B({...g,postalCode:t.target.value}),fullWidth:!0,margin:"dense",error:b.has("postalCode"),helperText:b.get("postalCode")}),e.jsxs(Q,{fullWidth:!0,margin:"dense",children:[e.jsx(V,{id:"country-label",sx:{color:"#737aff"},children:"Country"}),e.jsxs(X,{value:g.country,onChange:t=>B({...g,country:t.target.value}),label:"Country",sx:{color:"#fff",".MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},".MuiSvgIcon-root":{color:"#737aff"}},children:[e.jsx(S,{value:"BY",children:"Belarus"}),e.jsx(S,{value:"RU",children:"Russia"}),e.jsx(S,{value:"US",children:"USA"})]})]}),e.jsx(_,{variant:"outlined",onClick:()=>{const t=ye(g);R(t),!(t.size>0)&&(k([...v,g]),B({id:"",streetName:"",city:"",postalCode:"",country:""}),R(new Map))},sx:{mt:1},children:"Add Address"})]})]}),u===2&&e.jsxs("section",{className:i.section,children:[e.jsx("h2",{children:"Change Password"}),e.jsx(h,{label:"Current Password",type:"password",value:m,onChange:t=>p(t.target.value),fullWidth:!0,margin:"normal",className:`${i["edit-field"]}`,sx:{color:"#fff",".MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},".MuiSvgIcon-root":{color:"#737aff"}}}),e.jsx(h,{className:`${i["edit-field"]}`,label:"New Password",type:"password",value:c,onChange:t=>A(t.target.value),fullWidth:!0,margin:"normal",sx:{color:"#fff",".MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},".MuiSvgIcon-root":{color:"#737aff"}}}),e.jsx(h,{className:`${i["edit-field"]}`,label:"Confirm New Password",type:"password",value:w,onChange:t=>O(t.target.value),fullWidth:!0,margin:"normal",error:!!M,helperText:M,sx:{color:"#fff",".MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#737aff"},".MuiSvgIcon-root":{color:"#737aff"}}}),e.jsx(_,{variant:"contained",onClick:ie,sx:{mt:2,backgroundColor:"#737aff"},children:"Change Password"})]}),j&&e.jsx(_,{variant:"contained",onClick:ae,disabled:G,sx:{mt:2,backgroundColor:"#737aff"},children:"Save Changes"})]})}export{Me as default};
